---
import { getCollection, type CollectionEntry } from "astro:content";
import MainLayout from "../../layouts/MainLayout.astro";

// Fetch all entries from the 'portfolio' collection
const projects: CollectionEntry<"portfolio">[] =
    await getCollection("portfolio");

// Sort by date (newest first)
const sortedProjects = projects.sort(
    (a, b) => b.data.publishDate.valueOf() - a.data.publishDate.valueOf(),
);
---

<MainLayout title="Our Work | Digital Soul">
    <section class="max-w-6xl mx-auto px-6 py-20">
        <div class="mb-12">
            <h1 class="text-6xl font-bold tracking-tighter">Selected Works.</h1>
            <p class="text-xl opacity-70 mt-4">
                Exploring the intersection of design and performance.
            </p>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
            {
                sortedProjects.map((project) => (
                    <a
                        href={`/portfolio/${project.slug}`}
                        class="group cursor-pointer"
                    >
                        <div class="card bg-base-200 shadow-sm overflow-hidden transition-all duration-500 group-hover:shadow-2xl group-hover:-translate-y-2">
                            <figure class="h-72 overflow-hidden">
                                <img
                                    src={project.data.image}
                                    alt={project.data.title}
                                    class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-110"
                                />
                            </figure>
                            <div class="card-body">
                                <div class="flex justify-between items-start">
                                    <h2 class="card-title text-xl">
                                        {project.data.title}
                                    </h2>
                                    <div class="badge badge-outline opacity-50">
                                        {project.data.client}
                                    </div>
                                </div>
                                <p class="line-clamp-2 opacity-70">
                                    {project.data.description}
                                </p>
                                <div class="card-actions justify-end mt-4">
                                    {/* FIXED: Added : string to the tag parameter below */}
                                    {project.data.tags.map((tag: string) => (
                                        <span class="text-xs uppercase tracking-widest font-bold text-primary">
                                            {tag}
                                        </span>
                                    ))}
                                </div>
                            </div>
                        </div>
                    </a>
                ))
            }
        </div>
    </section>
</MainLayout>
